{% extends 'dashboard/dashboard.html' %}
{% load static %}
{% block style %}
<link rel="stylesheet" href="{% static 'agents/css/style.css' %}">
{% endblock %}
{% block title %}Агенты{% endblock %}
{% block content %}

<div class="main-content" style="max-width:1200px;margin:40px auto 0 auto;background:#181818;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.10);padding:32px 16px;">
    <h1 class="agent-detail-title" style="text-align:center;margin-bottom:24px;">Агенты</h1>
    <div class="list">
        <div class="list-content" id="agents-list"></div>
    </div>
    <button class="create-btn" onclick="location.href='/agents/create/'" style="display:block;margin:32px auto 0 auto;">Создать агента</button>
</div>
<div class="toast" id="toast"></div>
<script>
function showToast(msg, type='success') {
    const toast = document.getElementById('toast');
    toast.innerText = msg;
    toast.className = 'toast show';
    if (type === 'error') toast.style.background = 'linear-gradient(90deg,#ef4444,#fca5a5)';
    else toast.style.background = '';
    setTimeout(() => { toast.className = 'toast'; toast.style.background = ''; }, 2500);
}
function loadAgents() {
    fetch('http://localhost:8000/agents')
      .then(resp => resp.json())
      .then(data => {
          const list = document.getElementById('agents-list');
          list.innerHTML = '';
          data.forEach(agent => {
              const div = document.createElement('div');
              div.className = 'item list-item';
              div.innerHTML = `<span>${agent.name}</span> <span style='color:#aaa;'>ID: ${agent.id}</span>`;
              div.onclick = () => location.href = `/agents/${agent.id}/`;
              list.appendChild(div);
          });
      })
      .catch(() => showToast('Ошибка загрузки агентов', 'error'));
}
document.addEventListener('DOMContentLoaded', loadAgents);
</script>
{% endblock %}