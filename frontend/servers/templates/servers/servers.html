{% extends 'dashboard/dashboard.html' %}
{% load static %}
{% block style %}
<link rel="stylesheet" href="{% static 'agents/css/style.css' %}">
{% endblock %}
{% block title %}Серверы{% endblock %}
{% block content %}
<div class="main-content" style="max-width:1000px;margin:auto;">
    <h1 style="text-align:center;margin-bottom:24px;">Серверы</h1>
    <div class="list">
        <div class="list-content" id="servers-list"></div>
    </div>
    <button class="create-btn" onclick="location.href='/servers/create/'" style="display:block;margin:32px auto 0 auto;">Создать сервер</button>
</div>
<div class="toast" id="toast"></div>
<script>
function showToast(msg, type='success') {
    const toast = document.getElementById('toast');
    toast.innerText = msg;
    toast.className = 'toast show';
    if (type === 'error') toast.style.background = 'linear-gradient(90deg,#ef4444,#fca5a5)';
    else toast.style.background = '';
    setTimeout(() => { toast.className = 'toast'; toast.style.background = ''; }, 2500);
}
function loadServers() {
    fetch('http://localhost:8000/servers')
      .then(resp => resp.json())
      .then(data => {
          const list = document.getElementById('servers-list');
          list.innerHTML = '';
          data.forEach(server => {
              const div = document.createElement('div');
              div.className = 'item list-item';
              div.innerHTML = `<span>${server.name}</span> <span style='color:#aaa;'>ID: ${server.id}</span>`;
              div.onclick = () => location.href = `/servers/${server.id}/`;
              list.appendChild(div);
          });
      })
      .catch(() => showToast('Ошибка загрузки серверов', 'error'));
}
document.addEventListener('DOMContentLoaded', loadServers);
</script>
{% endblock %}